"use strict";var App;!function(t){t.app=angular.module("app",["ngSanitize","config","common","ui.bootstrap","ui.router"])}(App||(App={}));var App;!function(t){var e=function(){function t(){}return t.currentUser=["datacontext",function(t){return t.getCurrentUser()}],t}();t.Dependencies=e}(App||(App={}));var App;!function(t){var e=function(){function e(e,o){o.otherwise("/"),e.state("app",{"abstract":!0,url:"/",templateUrl:"app/shell/shell.htm",controller:t.Controllers.ShellController.Id,controllerAs:"shell",resolve:{currentUser:t.Dependencies.currentUser}}),e.state("app.home",{url:"",views:{"menu@app":t.Views.menu,"main@app":t.Views.projects,"footer@app":t.Views.footer}}),e.state("app.home.helpdesk",{url:"helpdesk",views:{"main@app":t.Views.helpdesk}}),e.state("app.summary",{url:"summary",views:{"menu@app":t.Views.menu,"main@app":t.Views.summary,"footer@app":t.Views.footer}}),e.state("app.summary.range",{url:"/start/{start:[0-9]{4}-[0-9]{1,2}-[0-9]{1,2}}/end/{end:[0-9]{4}-[0-9]{1,2}-[0-9]{1,2}}",views:{"menu@app":t.Views.menu,"main@app":t.Views.summary,"footer@app":t.Views.footer}})}return e.$inject=["$stateProvider","$urlRouterProvider"],e}();t.Routes=e,t.app.config(e)}(App||(App={}));var App;!function(t){var e=function(){function t(){}return t.getTs=function(){return"?_="+(new Date).getTime()},t.projects={templateUrl:"app/kanban/kanban.htm"+t.getTs(),controller:"kanbanController",controllerAs:"vm",resolve:{kanbanConfig:function(){var t=["Not Started","In Progress","Testing","Completed"],e={siteUrl:"/media",listName:"Projects",previousMonths:18,timeLogListName:"Time Log",statuses:t,columns:[{title:"Queue",id:"backlog-tasks",className:"panel panel-info",status:t[0],tasks:[]},{title:"In Progress",id:"in-progress-tasks",className:"panel panel-danger",status:t[1],tasks:[]},{title:"Testing",id:"testing-tasks",className:"panel panel-warning",status:t[2],tasks:[]},{title:"Done",id:"completed-tasks",className:"panel panel-success",status:t[3],tasks:[]}]};return e}}},t.helpdesk={templateUrl:"app/kanban/kanban.htm"+t.getTs(),controller:"kanbanController",controllerAs:"vm",resolve:{kanbanConfig:function(){var t=["Not Started","In Progress","Completed","Waiting on someone else"],e={siteUrl:"/ws",listName:"Tasks",previousMonths:1,timeLogListName:"Time Log",statuses:t,columns:[{title:"Queue",id:"backlog-tasks",className:"panel panel-info",status:t[0],tasks:[]},{title:"In Progress",id:"in-progress-tasks",className:"panel panel-danger",status:t[1],tasks:[]},{title:"Waiting on someone else",id:"waiting-on-someone-tasks",className:"panel panel-warning",status:t[2],tasks:[]},{title:"Done",id:"completed-tasks",className:"panel panel-success",status:t[3],tasks:[]}]};return e}}},t.summary={templateUrl:"app/reports/summary.htm"+t.getTs(),controller:"projectSummaryController",controllerAs:"vm",resolve:{projectSiteConfigs:function(){return[{siteUrl:"/media",listName:"Time Log",title:"Projects",projectsListName:"Projects"},{siteUrl:"/ws",listName:"Time Log",title:"Support Requests",projectsListName:"Tasks"}]}}},t.menu={templateUrl:"app/menu/menu.htm"+t.getTs(),controller:"menuController",controllerAs:"vm"},t.footer={templateUrl:"app/footer/footer.htm"+t.getTs(),controller:"footerController",controllerAs:"vm"},t}();t.Views=e}(App||(App={}));var App;!function(t){var e;!function(e){var o=function(){function t(t){this.config=t,this.copyright="&copy; "+t.orgName+" "+(new Date).getFullYear()}return t.Id="footerController",t.$inject=["config"],t}();e.FooterController=o,t.app.controller(o.Id,o)}(e=t.Controllers||(t.Controllers={}))}(App||(App={}));var App;!function(t){var e;!function(e){var o=function(){function e(e,o,n,r,a,s){this.$scope=e,this.common=o,this.config=n,this.$stateParams=r,this.datacontext=a,this.kanbanConfig=s,this.projects=[],this.dragging={task:null},this.siteUrl=s.siteUrl,this.listName=s.listName,this.columns=s.columns,this.statuses=s.statuses,this.priorities=this.config.priorities,this.$parent=this.$scope.$parent.shell,this.changeQueue=[],this.currentUser=this.$parent.currentUser,this.userIsEditor=t.Utils.userIsEditor(this.currentUser,this.config.editGroups),this.now=new Date,this.refreshData(),document.getElementById("keywordFilter").focus()}return e.prototype.saveChanges=function(){if(!confirm("Are you sure you want to save changes to "+this.changeQueue.length+" items?"))return!1;var t=this;return this.datacontext.updateSoapListItems(this.changeQueue,this.siteUrl,this.listName).then(function(e){var o=e.data;o&&(t.changeQueue=[])}),!1},e.prototype.resetData=function(){return this.projects=[],this.projects=angular.copy(this.pristineProjectsData,this.projects),this.updateColumns(),this.changeQueue=[],!1},e.prototype.updateTask=function(t,e,o){void 0===o&&(o=void 0);for(var n=this,r=0;r<this.projects.length;r++)if(this.projects[r].Id==t){var a=this.projects[r],s=this.changeQueue.filter(function(e){return e.Id==t});switch(e.name){case"Status":a.Status.Value=e.value,/(not started|completed)/i.test(e.value)&&null==a.LastTimeOut&&n.clockOut(a.Id);break;case"OrderBy":if(!o)break}if(s.length>0){var i=s[0].fields.filter(function(t){return t.name==e.name});i.length>0?i[0].value=e.value:s[0].fields.push(e)}else this.changeQueue.push({Id:t,fields:[e]});return this.config.debug&&console.log(this.changeQueue),this.updateColumns(),r}return-1},e.prototype.updateColumns=function(t){void 0===t&&(t=!1);for(var e=this,o=0;o<this.columns.length;o++){var n=this.columns[o];n.tasks=e.projects.filter(function(t){return t.Status.Value==n.status})}(this.dragging.task||t)&&(this.$scope.$apply(),this.config.debug&&console.info("redraw"))},e.prototype.deleteTask=function(e,o){var n=this;if(confirm("Are you sure you want to delete the item with ID# "+e.Id+"?"))return this.datacontext.deleteListItem(e).then(function(){t.Utils.remove(n.projects,o),n.updateColumns(!0)}),!1},e.prototype.refreshData=function(){var t=this;return this.datacontext.getProjects(this.siteUrl,this.listName,!0,this.kanbanConfig.previousMonths).then(function(e){t.projects=e,t.updateColumns(),t.pristineProjectsData=angular.copy(t.projects,t.pristineProjectsData)}),!1},e.prototype.viewItem=function(e){return t.SharePoint.Utils.openSpDisplayForm(this.siteUrl,this.listName,e),!1},e.prototype.newItem=function(){var e=this;return t.SharePoint.Utils.openSpNewForm(this.siteUrl,this.listName,"New Item",function(){console.info(arguments),e.refreshData()}),!1},e.prototype.range=function(t){for(var e=[],o=1;t>=o;o++)e.push(o);return e},e.prototype.clockIn=function(e){var o=this;try{var n=this.findProjectById(e);if(!n)return console.warn("ERROR: Controllers.KanBanController.clockIn() - project is null"),!1;var r=new Date;n.LastTimeIn=r,n.LastTimeOut=null;var a=o.kanbanConfig.siteUrl+"/_vti_bin/listdata.svc/"+t.SharePoint.Utils.toCamelCase(o.kanbanConfig.timeLogListName),s=JSON.stringify({ProjectId:e,TimeIn:r.toISOString()});this.datacontext.executeRestRequest(a,s,!1,"POST").then(function(e){if(o.config.debug&&(console.info("Controllers.KanBanController.clockIn() returned..."),console.info(e)),201!=e.status)return void alert("Error creating entry in "+o.kanbanConfig.timeLogListName+". Status: "+e.status+"; Status Text: "+e.statusText);var r={LastTimeIn:t.Utils.parseMsDateTicks(e.data.d.TimeIn),LastTimeOut:null};o.datacontext.updateListItem(n,r,function(t,e,a){return o.config.debug&&(console.info("clockIn()"),console.info(arguments)),a&&204!=a.status?void alert("Error in Kanban.clockIn(). Failed to clock out."):(n.LastTimeIn=r.LastTimeIn,void(n.LastTimeOut=null))})})}catch(i){console.warn("ERROR: Controllers.KanBanController.clockIn()..."),console.warn(i)}finally{return!1}},e.prototype.clockOut=function(t){var e=this;try{var o=this.findProjectById(t);if(!o)return console.warn("ERROR: Controllers.KanBanController.clockOut() - project is null"),!1;var n=new Date;if(!this.config.isProduction)return void(o.LastTimeOut=n);this.datacontext.getSpListItems(this.kanbanConfig.siteUrl,this.kanbanConfig.timeLogListName,"ProjectId eq "+o.Id,null,"Id desc",null,1).then(function(t){var r=t[0],a={LastTimeOut:n.toISOString()},s={TimeOut:n.toISOString()};e.datacontext.updateListItem(r,s,function(t,o,n){return e.config.debug&&(console.info("clockOut()"),console.info(arguments)),n&&204!=n.status?void alert("Error in Kanban.clockOut(). Failed to clock out."):void 0}),e.datacontext.updateListItem(o,a,function(t,r,a){return e.config.debug&&(console.info("clockOut()"),console.info(arguments)),a&&204!=a.status?void alert("Error in Kanban.clockOut(). Failed to clock out."):(o.LastTimeOut=n,void e.updateColumns(!0))})})}catch(r){console.warn("ERROR: Controllers.KanBanController.clockOut()..."),console.warn(r)}finally{return!1}},e.prototype.findProjectById=function(t){if(null==this.projects)return null;for(var e=0;e<this.projects.length;e++)if(this.projects[e].Id==t)return this.projects[e];return null},e.prototype.isActive=function(t){return null==t.LastTimeOut&&null!=t.LastTimeIn},e.Id="kanbanController",e.$inject=["$scope","common","config","$stateParams","datacontext","kanbanConfig"],e}();e.KanbanController=o,t.app.controller(o.Id,o)}(e=t.Controllers||(t.Controllers={}))}(App||(App={}));var App;!function(t){var e;!function(e){var o=function(){function t(t,e,o,n){this.$scope=t,this.config=e,this.$state=o,this.$stateParams=n;var r=this.$scope.$parent.shell;this.currentUser=r.currentUser,this.appTitle=e.appTitle}return t.Id="menuController",t.$inject=["$scope","config","$state","$stateParams"],t}();e.MenuController=o,t.app.controller(o.Id,o)}(e=t.Controllers||(t.Controllers={}))}(App||(App={}));var App;!function(t){var e;!function(e){var o=function(){function e(t,e,o,n){this.$state=t,this.$stateParams=e,this.datacontext=o,this.projectSiteConfigs=n,this.updateState=!1;var r=new Date,a=r.getDay(),s=r.getDate(),i=1,l=6,c=a==i?s:s-(a-i);if(e.start&&e.end){var u=e.start.split("-"),p=e.end.split("-");this.startDate=new Date(parseInt(u[0]),parseInt(u[1])-1,parseInt(u[2]),0,0,0),this.endDate=new Date(parseInt(p[0]),parseInt(p[1])-1,parseInt(p[2]),23,59,0),this.getData()}else this.updateState=!0,this.startDate=new Date(r.getFullYear(),r.getMonth(),c,0,0,0),this.endDate=new Date(r.getFullYear(),r.getMonth(),c+l,23,59,0);this.groupedProjects=[]}return e.prototype.getData=function(){var t=this;this.groupedProjects=[];for(var e=0;e<this.projectSiteConfigs.length;e++){var o=t.projectSiteConfigs[e],n=t.projectSiteConfigs[e].title,r=[];this.datacontext.getProjectTotals(o.siteUrl,o.listName,this.startDate,this.endDate,n,o.projectsListName).then(function(e){e.forEach(function(e){var o=e.Name;r.indexOf(o)<0?(r.push(o),t.groupedProjects.push({Name:o,ProjectGroups:[{Title:e.Title,Projects:e.Projects.filter(function(t){return t.PersonName==o}).sort(function(t,e){return t.TotalHours<e.TotalHours?1:0})}]})):t.groupedProjects.filter(function(t){return t.Name==o})[0].ProjectGroups.push({Title:e.Title,Projects:e.Projects.filter(function(t){return t.PersonName==o}).sort(function(t,e){return t.TotalHours<e.TotalHours?1:0})})})})}return!1},e.prototype.viewItem=function(e){var o={Id:e.Id,Title:e.Title};return t.SharePoint.Utils.openSpDisplayForm(e.SiteUrl,e.ListName,o),!1},e.Id="projectSummaryController",e.$inject=["$state","$stateParams","datacontext","projectSiteConfigs"],e}();e.ProjectSummary=o,t.app.controller(o.Id,o)}(e=t.Controllers||(t.Controllers={}))}(App||(App={}));var App;!function(t){t.app.run(["$rootScope","$state","$stateParams",function(t,e,o){t.$state=e,t.$stateParams=o,e.go("app.home")}])}(App||(App={}));var App;!function(t){var e;!function(e){var o=function(){function e(t,e,o,n){this.$http=t,this.$q=e,this.common=o,this.config=n,this.cache={},this.common.hideLoader()}return e.prototype.executeRestRequest=function(t,e,o,n,r){void 0===e&&(e=void 0),void 0===o&&(o=!1),void 0===n&&(n="GET"),void 0===r&&(r=void 0);var a=this,s=this.$q.defer();this.common.showLoader();var i={url:this.config.serverHostname+t,method:n,cache:o,headers:{Accept:"application/json;odata=verbose"}};if(e&&(i.data=e),r)for(var l in i.headers)i.headers[l]=r[l];return this.$http(i).then(function(t){s.resolve(t)}).finally(function(){a.common.hideLoader()}),s.promise},e.prototype.getSpListItems=function(e,o,n,r,a,s,i){void 0===n&&(n=null),void 0===r&&(r=null),void 0===a&&(a=null),void 0===s&&(s=null),void 0===i&&(i=10);var l=this.$q.defer();this.common.showLoader();var c=[e+"/_vti_bin/listdata.svc/"+t.SharePoint.Utils.toCamelCase(o)];return n&&c.push("$filter="+n),r&&c.push("$select="+r),a&&c.push("$orderby="+a),s&&c.push("$expand="+s),c.push("$top="+i),this.executeRestRequest(c.join("&").replace(/\&/,"?")).then(function(t){return 200!=t.status?(l.reject(t.statusText),void console.warn(t)):void l.resolve(t.data.d.results?t.data.d.results:t.data.d)}),l.promise},e.prototype.getProjects=function(e,o,n,r){void 0===n&&(n=!1),void 0===r&&(r=6);var a=this.$q.defer();if(!this.config.isProduction)return this.getTestData();var s=new Date,i=new Date(s.getFullYear(),s.getMonth()-r,s.getDate(),0,0,0).toISOString(),l="CategoryValue ne 'Log' and Created gt datetime'"+i+"'",c="Id,Title,AssignedTo,Attachments,Priority,Status,StartDate,DueDate,OrderBy,LastTimeIn,LastTimeOut",u="PriorityValue asc,Created asc",p="AssignedTo,Attachments,Priority,Status";return this.getSpListItems(e,o,l,c,u,p,1e3).then(function(e){e.forEach(function(e){e.Created=t.Utils.parseMsDateTicks(e.Created),e.Modified=t.Utils.parseMsDateTicks(e.Modified),e.LastTimeIn&&(e.LastTimeIn=t.Utils.parseMsDateTicks(e.LastTimeIn)),e.LastTimeOut&&(e.LastTimeOut=t.Utils.parseMsDateTicks(e.LastTimeOut)),e.StartDate&&(e.StartDate=t.Utils.parseMsDateTicks(e.StartDate)),e.DueDate&&(e.DueDate=t.Utils.parseMsDateTicks(e.DueDate))}),a.resolve(e)}),a.promise},e.prototype.getProject=function(e,o,n){return this.executeRestRequest(e+"/_vti_bin/listdata.svc/"+t.SharePoint.Utils.toCamelCase(o)+"("+n+")")},e.prototype.insertListItem=function(t,e){return void 0===e&&(e=void 0),this.executeRestRequest(t,JSON.stringify(e),!1,"POST")},e.prototype.updateListItem=function(t,e,o){var n=this,r=$.ajax({url:t.__metadata.uri,type:"POST",contentType:"application/json",processData:!1,beforeSend:function(e){e.setRequestHeader("If-Match",t.__metadata.etag),e.setRequestHeader("X-HTTP-Method","MERGE")},data:JSON.stringify(e)});r.done(function(){n.config.debug&&(console.info("Services.Datacontext.updateListItem() returned..."),console.info(arguments)),o&&o(arguments)}),r.always(function(){n.common.hideLoader()}),r.fail(function(t,e,r){o&&o(arguments),n.config.debug&&console.warn("Error in Datacontext.updateListItem(): "+e+" "+r)})},e.prototype.deleteListItem=function(t){var e={Accept:"application/json;odata=verbose","X-Http-Method":"DELETE","If-Match":t.__metadata.etag};return this.executeRestRequest(t.__metadata.uri,null,!1,"POST",e)},e.prototype.deleteAttachment=function(t){var e={Accept:"application/json;odata=verbose","X-HTTP-Method":"DELETE"};return this.executeRestRequest(t.__metadata.uri,null,!1,"POST",e)},e.prototype.executeSoapRequest=function(t,e,o,n,r,a,s){void 0===n&&(n=""),void 0===r&&(r=!1),void 0===a&&(a=void 0),void 0===s&&(s="lists.asmx");var i=this.$q.defer(),l=this;this.common.showLoader();var c=n+"/_vti_bin/"+s;if(o)for(var u=0;u<o.length;u++)e=e.replace("{"+u+"}",null==o[u]?"":o[u]);var p={url:c,data:e,method:"POST",cache:r,headers:{"Content-Type":"text/xml; charset=utf-8",SOAPAction:t}};if(a)for(var m in a)p.headers[m]=a[m];return this.$http(p).then(function(t){i.resolve(t)}).finally(function(){l.common.hideLoader()}),i.promise},e.prototype.updateSoapListItems=function(e,o,n){if(!this.config.isProduction){var r=this.$q.defer();return r.resolve({status:200,statusText:"OK"}),r.promise}for(var a="http://schemas.microsoft.com/sharepoint/soap/UpdateListItems",s='<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><UpdateListItems xmlns="http://schemas.microsoft.com/sharepoint/soap/"><listName>{0}</listName><updates>{1}</updates></UpdateListItems></soap:Body></soap:Envelope>',i=["<Batch OnError='Continue'>"],l=0;l<e.length;l++){i.push("<Method ID='1' Cmd='Update'>");for(var c=0;c<e[l].fields.length;c++)i.push("<Field Name='"+e[l].fields[c].name+"'>"+t.SharePoint.Utils.escapeColumnValue(e[l].fields[c].value)+"</Field>");i.push("<Field Name='ID'>"+e[l].Id+"</Field>"),i.push("</Method>")}return i.push("</Batch>"),s=s.replace(/\{0\}/,n).replace(/\{1\}/,i.join()),this.executeSoapRequest(a,s,null,o)},e.prototype.getSoapListItems=function(t,e,o,n,r,a){void 0===r&&(r=!1),void 0===a&&(a=25);var s='<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><GetListItems xmlns="http://schemas.microsoft.com/sharepoint/soap/"><listName>'+e+"</listName><query>"+n+"</query><viewFields>"+o+"</viewFields><rowLimit>"+a+"</rowLimit></GetListItems></soap:Body></soap:Envelope>";return this.executeSoapRequest("http://schemas.microsoft.com/sharepoint/soap/GetListItems",s,null,t,r)},e.prototype.searchPrincipals=function(t,e,o){void 0===e&&(e=10),void 0===o&&(o="User");var n=this.$q.defer(),r="http://schemas.microsoft.com/sharepoint/soap/SearchPrincipals",a=[t,e,o],s='<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><SearchPrincipals xmlns="http://schemas.microsoft.com/sharepoint/soap/"><searchText>{0}</searchText><maxResults>{1}</maxResults><principalType>{2}</principalType></SearchPrincipals></soap:Body></soap:Envelope>';return this.executeSoapRequest(r,s,a,"",!0,null,"People.asmx").then(function(t){var e=t.data,o=[];$(e).find("PrincipalInfo").each(function(t,e){o.push({AccountName:$("AccountName",e).text(),UserInfoID:parseInt($("UserInfoID",e).text()),DisplayName:$("DisplayName",e).text(),Email:$("Email",e).text(),Title:$("Title",e).text(),IsResolved:"true"==$("IsResolved",e).text()?!0:!1,PrincipalType:$("PrincipalType",e).text()})}),n.resolve(o)}),n.promise},e.prototype.getCurrentUser=function(){var t=this.$q.defer(),e=this;if(this.cache.currentUser)return t.resolve(this.cache.currentUser),t.promise;var o={ID:null,Title:null,Name:null,EMail:null,JobTitle:null,Department:null,Account:null,UserName:null,Office:null,Groups:[]};if(!this.config.isProduction)return this.$http({url:"/testuser.xml",method:"GET",dataType:"xml"}).then(function(n){var r=n.data,a=$(r).find("*").filter(function(){return"z:row"==this.nodeName.toLowerCase()});a.each(function(){o.ID=parseInt($(this).attr("ows_ID")),o.Title=$(this).attr("ows_Title"),o.Name=$(this).attr("ows_Name"),o.EMail=$(this).attr("ows_EMail"),o.JobTitle=$(this).attr("ows_JobTitle"),o.Department=$(this).attr("ows_Department"),o.Account=o.ID+";#"+o.Title,o.Groups=e.config.testUser.Groups}),t.resolve(o)}),e.cache.currentUser=o,t.promise;var e=this,n='<Query><Where><Eq><FieldRef Name="ID" /><Value Type="Counter"><UserID /></Value></Eq></Where></Query>',r='<ViewFields><FieldRef Name="ID" /><FieldRef Name="Name" /><FieldRef Name="EMail" /><FieldRef Name="Department" /><FieldRef Name="JobTitle" /><FieldRef Name="UserName" /><FieldRef Name="Office" /></ViewFields>';return this.getSoapListItems("","User Information List",r,n,!0).then(function(n){var r=n.data,a=$(r).find("*").filter(function(){return"z:row"==this.nodeName.toLowerCase()});a.each(function(){o.ID=parseInt($(this).attr("ows_ID")),o.Title=$(this).attr("ows_Title"),o.Name=$(this).attr("ows_Name"),o.EMail=$(this).attr("ows_EMail"),o.JobTitle=$(this).attr("ows_JobTitle"),o.Department=$(this).attr("ows_Department"),o.Account=o.ID+";#"+o.Title,o.Groups=[]}),o.Name?e.getUsersGroups(o.Name).then(function(n){o.Groups=n,e.cache.currentUser=o,t.resolve(o)}):(e.cache.currentUser=o,t.resolve(o))}),t.promise},e.prototype.getUsersGroups=function(t){var e=this.$q.defer(),o='<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><GetGroupCollectionFromUser xmlns="http://schemas.microsoft.com/sharepoint/soap/directory/"><userLoginName>'+t+"</userLoginName></GetGroupCollectionFromUser></soap:Body></soap:Envelope>",n="http://schemas.microsoft.com/sharepoint/soap/directory/GetGroupCollectionFromUser";return this.executeSoapRequest(n,o,null,"",!0,null,"usergroup.asmx").then(function(t){var o=t.data,n=$(o).find("errorstring");if(n&&""!=n.text())return void e.reject(n.text());var r=[];$(o).find("Group").each(function(t,e){r.push({id:parseInt($(e).attr("ID")),name:$(e).attr("Name")})}),e.resolve(r)}),e.promise},e.prototype.getTestData=function(){var e=this.$q.defer(),o=this;return o.$http({url:"/testdata.txt?_="+t.Utils.getTimestamp(),method:"GET"}).then(function(t){if(200!=t.status)return e.resolve(null),void e.reject(t.statusText);var o=t.data.d.results;e.resolve(o)}).finally(function(){o.common.hideLoader()}),e.promise},e.prototype.getProjectTotals=function(e,o,n,r,a,s){var i=this,l=this.$q.defer();n=t.Utils.parseDate(n),r=t.Utils.parseDate(r),this.config.debug&&(console.info(n),console.info(r));var c=function(t){for(var o=[],n=[],r=0;r<t.length;r++){var i=t[r].CreatedBy.Name;n.indexOf(i)>-1||(n.push(i),o.push({Name:i,Title:a,Projects:[]}))}for(var r=0;r<o.length;r++)for(var c=o[r],n=[],u=0;u<t.length;u++){var p=t[u];if(!(p.CreatedBy.Name!=c.Name||n.indexOf(p.ProjectId)>-1)){n.push(p.ProjectId);for(var m={Id:p.ProjectId,Title:p.Project.Title,TotalHours:0,PersonName:p.CreatedBy.Name,SiteUrl:e,ListName:s,Color:null},d=0;d<t.length;d++){var f=t[d];f.CreatedBy.Name==c.Name&&m.Id==f.ProjectId&&f.TimeIn&&f.TimeOut&&(m.TotalHours+=f.Hours)}c.Projects.push(m)}}l.resolve(o)};if(this.config.isProduction){var u=new Date(n.getFullYear(),n.getMonth(),n.getDate(),0,0,0).toISOString(),p=new Date(r.getFullYear(),r.getMonth(),r.getDate(),24,0,0).toISOString();this.getSpListItems(e,o,"TimeIn ne null and TimeOut ne null and TimeIn ge datetime'"+u+"' and TimeIn le datetime'"+p+"'","CreatedBy/Name,ProjectId,TimeIn,TimeOut,Hours,Project/Title","CreatedBy/Name,ProjectId,TimeIn","CreatedBy,Project",1e3).then(c)}else{this.common.hideLoader();var m="Projects"==a?"/test_time_entries.txt":"test_support_entries.txt";i.$http({url:m+"?_="+t.Utils.getTimestamp(),method:"GET"}).then(function(t){return 200!=t.status?(l.resolve(null),void l.reject(t.statusText)):void c(t.data.d.results)}).finally(function(){i.common.hideLoader()})}return l.promise},e.Id="datacontext",e}();e.Datacontext=o,t.app.factory(o.Id,["$http","$q","common","config",function(t,e,n,r){return new o(t,e,n,r)}])}(e=t.Services||(t.Services={}))}(App||(App={}));var App;!function(t){var e=function(){function t(t){this.$rootScope=t,this.$loader=$(".ajax-loader")}return t.prototype.showLoader=function(){this.$loader.show()},t.prototype.hideLoader=function(){this.$loader.hide()},t.Id="common",t}();t.Common=e,t.commonModule=angular.module("common",[]),t.commonModule.factory(e.Id,["$rootScope",function(t){return new e(t)}])}(App||(App={}));var App;!function(t){var e=function(){function t(){this.debug=!0,this.appPath="app/",this.appTitle="Dev Projects Kanban",this.editGroups=["Webster Owners","testers","Corporate Operations Manager","Corporate Executive Management","VP of Corporate Relations"],this.orgName="",this.productionHostname="webster",this.priorities=["(1) High","(2) Normal","(3) Low"],this.serverHostname="//"+window.location.hostname,this.testUser={Account:null,Department:"Vogon Affairs",EMail:"hitchiker@galaxy.org",Groups:[{id:42,name:"testers"}],ID:42,JobTitle:"Tester",Name:"domainmarvin",Office:"Heart of Gold",Title:"Paranoid Android",UserName:"marvin"},this.version="0.0.1",this.isProduction=!!(window.location.hostname.indexOf(this.productionHostname)>-1)}return t.Id="config",t}();t.Config=e,t.configModule=angular.module("config",[]),t.configModule.factory(e.Id,[function(){return new e}])}(App||(App={}));var App;!function(t){function e(){return{restrict:"A",scope:{projectsData:"="},link:function(e,o){e.$watch(function(e){var n,r=e.projectsData,a=[],s=o[0].id,i=document.getElementById(s),l=i.getContext("2d"),c=t.Utils.randomize(t.Utils.hexColors());i.__chartRef&&(n=i.__chartRef,n.clear(),n.destroy()),"undefined"!=typeof r&&r.forEach(function(t,e){t.Color=t.Color||(e<c.length?c[e]:c[c.length-e]),a.push({label:t.Id+": "+t.Title,value:t.TotalHours.toFixed(3),color:t.Color})}),n=new window.Chart(l).Doughnut(a,{responsive:!0,segmentShowStroke:!0,segmentStrokeColor:"#ccc",segmentStrokeWidth:1,percentageInnerCutout:50,animationSteps:100,animationEasing:"easeOutBounce",animateRotate:!0,animateScale:!1}),i.__chartRef=n})}}}t.app.directive("kanbanTask",function(){return{restrict:"A",scope:{kanbanTask:"=",parentScope:"="},link:function(t,e){t.$watch(function(t){e.on("dragstart",function(){t.parentScope.dragging={task:t.kanbanTask}})})}}}),t.app.directive("kanbanColumn",function(){return{restrict:"A",scope:{kanbanColumn:"=",parentScope:"="},link:function(t,e){function o(t){return t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),!1}t.$watch(function(t){e.on("drop",function(e){o(e);var n=t.parentScope,r=t.parentScope.dragging.task,a=t.kanbanColumn;if(r){var s={name:"Status",value:a.status};r.Status.Value=a.status,n.updateTask(r.Id,s),n.dragging.task=void 0}}).on("dragover",function(t){o(t)})})}}}),t.app.directive("datePicker",["$window",function(){return{restrict:"A",scope:{ngModel:"="},link:function(t,e){$(e).datepicker({changeMonth:!0,changeYear:!0}),t.$watch(function(t){var o=t.ngModel;$(e).val(moment(o).format("MM/DD/YYYY"))})}}}]),t.app.directive("totalHours",["$window",function(){return{restrict:"EA",scope:{projects:"="},link:function(t){t.$watch(function(t){for(var e=t.projects,o=0,n=0;n<e.length;n++)o+=e[n].TotalHours;t.total=o})},replace:!0,template:"<strong>{{total | number:3}}</strong>"}}]),t.app.directive("projectsTotalHours",["$window",function(){return{restrict:"EA",scope:{projectGroups:"="},link:function(t){t.$watch(function(t){for(var e=t.projectGroups,o=0,n=0;n<e.length;n++)for(var r=0;r<e[n].Projects.length;r++)o+=e[n].Projects[r].TotalHours;t.total=o})},replace:!1,template:"Total Hours: {{total | number:3}}"}}]),t.app.directive("doughnutChart",e)}(App||(App={}));var App;!function(t){t.app.filter("by_prop",function(){return t.Utils.filterByValue.$stateful=!0,t.Utils.filterByValue}),t.app.filter("sp_date",function(){function e(e){return e?t.Utils.parseDate(e).toLocaleDateString():e}return e.$stateful=!0,e}),t.app.filter("sp_datetime",function(){function e(e){return t.Utils.toUTCDateTime(e)}return e.$stateful=!0,e}),t.app.filter("active_tasks",function(){function t(t){var e=[];if(!t)return e;for(var o=0;o<t.length;o++)for(var n=0;n<t[o].tasks.length;n++)null==t[o].tasks[n].LastTimeOut&&null!=t[o].tasks[n].LastTimeIn&&e.push(t[o].tasks[n]);return e}return t.$stateful=!0,t})}(App||(App={}));var App;!function(t){var e=function(){function t(){}return t.userIsEditor=function(t,e){for(var o=0;o<e.length;o++)for(var n=0;n<t.Groups.length;n++)if(e[o]==t.Groups[n].name)return!0;return!1},t.indexOf=function(t,e){if(Array.prototype.indexOf)return Array.prototype.indexOf.apply(t,[e]);for(var o=0;o<t.length;o++)if(t[o]===e)return o;return-1},t.getTimestamp=function(){return"?_="+(new Date).getTime()},t.parseMsDateTicks=function(t){return null==t?t:new Date(parseInt(t.replace(/\D/g,"")))},t.toUTCDateTime=function(e){if(!e)return e;e.constructor===String&&(e=t.parseMsDateTicks(e));var o=e.getUTCMinutes(),n=e.getUTCHours(),r=e.getUTCSeconds();return e.toLocaleDateString()+" "+(10>n?"0"+n:n)+":"+(10>o?"0"+o:o)+":"+(10>r?"0"+r:r)},t.parseDate=function(t){if(!t)return null;if("object"==typeof t&&t.constructor==Date)return t;var e,o,n,r,a,s=/\d{1,2}\/\d{1,2}\/\d{2,4}/,i=/\d{1,2}-\d{1,2}-\d{2,4}/,l=/\d{4}-\d{1,2}-\d{1,2}/,c=/(\/|)\d{13}(\/|)/,u=/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}/,p=null;return t=l.test(t)?t:(t+"").replace(/[^0-9\/\-]/g,""),""==t?null:(s.test(t)||i.test(t)?(e=t.split(s.test(t)?"/":"-"),o=parseInt(e[0])-1,n=parseInt(e[1]),r=parseInt(e[2]),r=100>r?2e3+r:r,p=new Date(r,o,n,0,0,0,0)):l.test(t)||u.test(t)?(e=t.split("-"),r=parseInt(e[0]),o=parseInt(e[1])-1,n=parseInt(e[2]),r=100>r?2e3+r:r,/T/.test(t)?(a=t.split("T")[1].split(":"),p=new Date(r,o,n,~~a[0],~~a[1],~~a[2])):p=new Date(r,o,n,0,0,0)):c.test(t)&&(p=new Date(parseInt(t.replace(/\D/g,"")))),p)},t.filterByValue=function(t,e){if(!t)return[];for(var o=[],n=0;n<t.length;n++)for(var r in t[n])t[n][r]==e&&o.push(t[n]);return o},t.getUniqueKeyValues=function(t,e){for(var o=[],n=0;n<t.length;n++){var r=t[n][e];o.indexOf(r)>-1||o.push(r)}return o.sort()},t.remove=function(t,e,o){void 0===o&&(o=void 0);var n=t.slice((o||e)+1||t.length);return t.length=0>e?t.length+e:e,t.push.apply(t,n)},t.clone=function(e){if(!(e instanceof Object))return e;var o,n=e.constructor;switch(n){case RegExp:o=new n(e);break;case Date:o=new n(e.getTime());break;default:o=new n}for(var r in e)o[r]=t.clone(e[r]);return o},t.randomize=function(t){for(var e=t.length-1;e>0;e--){var o=Math.floor(Math.random()*(e+1)),n=t[e];t[e]=t[o],t[o]=n}return t},t.randomColor=function(){return"#"+Math.floor(16777215*Math.random()).toString(16)},t.hexColors=function(){return["#011f4b","#03396c","#005b96","#6497b1","#b3cde0","#edc951","#eb6841","#cc2a36","#4f372d","#00a0b0","#d11141","#00b159","#00aedb","#f37735","#ffc425","#bb1515","#e0cda7","#2a334f","#6b4423","#ac8f57","#a67c00","#bf9b30","#ffbf00","#ffcf40","#ffdc73","#e8d174","#e39e54","#d64d4d","#4d7358","#9ed670","#b62020","#cb2424","#fe2e2e","#fe5757","#fe8181","#efbbff","#d896ff","#be29ec","#800080","#660066","#007777","#006666","#005555","#004444","#003333","#1b85b8","#5a5255","#559e83","#ae5a41","#c3cb71"]},t}();t.Utils=e}(App||(App={}));var App;!function(t){var e;!function(t){var e=function(){function e(e,o,n,r,a){var s=n.replace(/\s/g,"");o=t.Utils.formatSubsiteUrl(o);var i=e+o+"_vti_bin/listdata.svc/Attachments(EntitySet='{0}',ItemId={1},Name='{2}')";i=i.replace(/\{0\}/,s).replace(/\{1\}/,r+"").replace(/\{2\}/,a),this.__metadata={uri:i,content_type:"application/octetstream",edit_media:i+"/$value",media_etag:null,media_src:e+o+"/Lists/"+n+"/Attachments/"+r+"/"+a,type:"Microsoft.SharePoint.DataService.AttachmentsItem"},this.EntitySet=s,this.ItemId=r,this.Name=a}return e}();t.SpAttachment=e;var o=function(){function t(){}return t}();t.SpItem=o}(e=t.SharePoint||(t.SharePoint={}))}(App||(App={}));var App;!function(t){var e;!function(t){var e=function(){function e(){}return e.formatSubsiteUrl=function(t){return t?/\/$/.test(t)?t:t+"/":"/"},e.toCamelCase=function(t){return t.toString().replace(/\s*\b\w/g,function(t){return(t[1]||t[0]).toUpperCase()}).replace(/\s/g,"").replace(/\'s/,"S").replace(/[^A-Za-z0-9\s]/g,"")},e.escapeColumnValue=function(t){return"string"==typeof t?t.replace(/&(?![a-zA-Z]{1,8};)/g,"&amp;"):t},e.openSpForm=function(t,e,o,n,r){void 0===e&&(e="Project Item"),void 0===o&&(o=function(){}),void 0===n&&(n=300),void 0===r&&(r=400);var a=window.ExecuteOrDelayUntilScriptLoaded,s=window.SP;return a(function(){s.UI.ModalDialog.showModalDialog({title:e,showClose:!0,url:t,dialogReturnValueCallback:o})},"sp.js"),!1},e.openSpDisplayForm=function(e,o,n,r,a){void 0===r&&(r=!1),void 0===a&&(a=function(){});var s=e+"/Lists/"+o.replace(/\s/g,"%20")+"/"+(r?"Edit":"Disp")+"Form.aspx?ID="+n.Id;return t.Utils.openSpForm(s,n.Title,a),!1},e.openSpNewForm=function(e,o,n,r){void 0===n&&(n="New Item"),void 0===r&&(r=function(){});var a=e+"/Lists/"+o.replace(/\s/g,"%20")+"/NewForm.aspx";return t.Utils.openSpForm(a,n,r),!1},e}();t.Utils=e}(e=t.SharePoint||(t.SharePoint={}))}(App||(App={}));var App;!function(t){var e;!function(e){var o=function(){function t(t,e,o){this.$rootScope=t,this.config=e,this.currentUser=o}return t.Id="shellController",t.$inject=["$rootScope","config","currentUser"],t
}();e.ShellController=o,t.app.controller(o.Id,o)}(e=t.Controllers||(t.Controllers={}))}(App||(App={}));